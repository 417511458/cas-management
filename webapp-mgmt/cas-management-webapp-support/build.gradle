description = "Apereo CAS Management Web Application Support"

repositories {
    mavenLocal()
    jcenter()
    maven { url 'https://oss.sonatype.org/content/repositories/snapshots' }
    maven { url 'https://build.shibboleth.net/nexus/content/repositories/releases/' }
}

dependencies {
    implementation libraries.metrics
    implementation libraries.pac4j
    implementation libraries.casclient
    implementation libraries.groovy
    implementation libraries.opensaml
    implementation libraries.springcloudconfigclient
    optional libraries.springbootconfigmetadata

    implementation libraries.thymeleaf

    implementation ("org.apereo.cas:cas-server-core-api-authentication:$casVersion") {
        exclude group: "org.apereo.cas", module: "cas-server-core-configuration"
        exclude group: "org.apereo.cas", module: "cas-server-core-configuration-api"
        exclude group: "org.apereo.cas", module: "cas-server-core-web"
    }

    implementation ("org.apereo.cas:cas-server-core-util:$casVersion")
        {
            exclude group: "org.apereo.cas", module: "cas-server-core-configuration"
            exclude group: "org.apereo.cas", module: "cas-server-core-configuration-api"
            exclude group: "org.apereo.cas", module: "cas-server-core-web"
        }

    implementation ("org.apereo.cas:cas-server-core-authentication-attributes:$casVersion") {

            exclude group: "org.apereo.cas", module: "cas-server-core-configuration"
        exclude group: "org.apereo.cas", module: "cas-server-core-configuration-api"
        exclude group: "org.apereo.cas", module: "cas-server-core-web"
    }
    implementation ("org.apereo.cas:cas-server-core-api-configuration:$casVersion") {
        exclude group: "org.apereo.cas", module: "cas-server-core-configuration"
        exclude group: "org.apereo.cas", module: "cas-server-core-configuration-api"
        exclude group: "org.apereo.cas", module: "cas-server-core-web"
    }
    implementation ("org.apereo.cas:cas-server-core-services:$casVersion") {
        exclude group: "org.apereo.cas", module: "cas-server-core-configuration"
        exclude group: "org.apereo.cas", module: "cas-server-core-configuration-api"
        exclude group: "org.apereo.cas", module: "cas-server-core-web"
    }
    implementation ("org.apereo.cas:cas-server-core-services-registry:$casVersion") {
        exclude group: "org.apereo.cas", module: "cas-server-core-configuration"
        exclude group: "org.apereo.cas", module: "cas-server-core-configuration-api"
        exclude group: "org.apereo.cas", module: "cas-server-core-web"
    }
    implementation ("org.apereo.cas:cas-server-core-web:$casVersion") {
        exclude group: "org.apereo.cas", module: "cas-server-core-configuration"
        exclude group: "org.apereo.cas", module: "cas-server-core-configuration-api"
        exclude group: "org.apereo.cas", module: "cas-server-core-web"
    }
    implementation ("org.apereo.cas:cas-server-core-logging-config:$casVersion"){
        exclude group: "org.apereo.cas", module: "cas-server-core-configuration"
        exclude group: "org.apereo.cas", module: "cas-server-core-configuration-api"
        exclude group: "org.apereo.cas", module: "cas-server-core-web"
    }
    implementation ("org.apereo.cas:cas-server-support-ws-idp-api:$casVersion"){
        exclude group: "org.apereo.cas", module: "cas-server-core-configuration"
        exclude group: "org.apereo.cas", module: "cas-server-core-configuration-api"
        exclude group: "org.apereo.cas", module: "cas-server-core-web"
    }
    implementation ("org.apereo.cas:cas-server-support-person-directory:$casVersion") {
        exclude group: "org.apereo.cas", module: "cas-server-core-configuration"
        exclude group: "org.apereo.cas", module: "cas-server-core-configuration-api"
        exclude group: "org.apereo.cas", module: "cas-server-core-web"
    }
    implementation ("org.apereo.cas:cas-server-support-surrogate-api:$casVersion"){
        exclude group: "org.apereo.cas", module: "cas-server-core-configuration"
        exclude group: "org.apereo.cas", module: "cas-server-core-configuration-api"
        exclude group: "org.apereo.cas", module: "cas-server-core-web"
    }

    implementation ("org.apereo.cas:cas-server-support-oauth-services:$casVersion"){
        exclude group: "org.apereo.cas", module: "cas-server-core-configuration"
        exclude group: "org.apereo.cas", module: "cas-server-core-configuration-api"
        exclude group: "org.apereo.cas", module: "cas-server-core-web"
    }
    implementation ("org.apereo.cas:cas-server-support-saml-idp-core:$casVersion"){
        exclude group: "org.apereo.cas", module: "cas-server-core-configuration"
        exclude group: "org.apereo.cas", module: "cas-server-core-configuration-api"
        exclude group: "org.apereo.cas", module: "cas-server-core-web"
    }
    implementation ("org.apereo.cas:cas-server-support-oidc-services:$casVersion"){
        exclude group: "org.apereo.cas", module: "cas-server-core-configuration"
        exclude group: "org.apereo.cas", module: "cas-server-core-configuration-api"
        exclude group: "org.apereo.cas", module: "cas-server-core-web"
    }
    implementation ("org.apereo.cas:cas-server-support-oidc-core:$casVersion") {
        exclude group: "org.apereo.cas", module: "cas-server-core-configuration"
        exclude group: "org.apereo.cas", module: "cas-server-core-configuration-api"
        exclude group: "org.apereo.cas", module: "cas-server-core-web"
    }
    implementation ("org.apereo.cas:cas-server-support-ws-idp-api:$casVersion"){
        exclude group: "org.apereo.cas", module: "cas-server-core-configuration"
        exclude group: "org.apereo.cas", module: "cas-server-core-configuration-api"
        exclude group: "org.apereo.cas", module: "cas-server-core-web"
    }
    implementation ("org.apereo.cas:cas-server-support-grouper-core:$casVersion"){
        exclude group: "org.apereo.cas", module: "cas-server-core-configuration"
        exclude group: "org.apereo.cas", module: "cas-server-core-configuration-api"
        exclude group: "org.apereo.cas", module: "cas-server-core-web"
    }
    
    testImplementation ("org.apereo.cas:cas-server-core-services-authentication:$casVersion"){
        exclude group: "org.apereo.cas", module: "cas-server-core-configuration"
        exclude group: "org.apereo.cas", module: "cas-server-core-configuration-api"
        exclude group: "org.apereo.cas", module: "cas-server-core-web"
    }
    //testImplementation (path: ":cas-server-core-services", configuration: "tests")
}

task generateConfigurationMetadata(type: JavaExec) {
    doFirst {
        println "\nRunning CAS Spring configuration metadata processor in addition to the native " +
                "Spring Boot metadata processor, to create configuration " +
                "metadata for nested and indexed properties. The process starts with the build directory " +
                "at [$buildDir] for the CAS configuration module at [$projectDir.canonicalPath].\n"
    }
    main = "org.apereo.cas.configuration.metadata.ConfigurationMetadataGenerator"
    classpath = sourceSets.main.runtimeClasspath
    args buildDir, projectDir.canonicalPath
}

compileJava.dependsOn(processResources)

if (!Boolean.getBoolean("skipNestedConfigMetadataGen")) {
    jar.dependsOn(generateConfigurationMetadata)
}


